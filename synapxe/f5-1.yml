- name: Parse member list into structured data
  set_fact:
    pool_members: >-
      {{
        members.splitlines()
        | reject('match', '^\\s*$')  # Remove empty lines
        | map('regex_replace', '^([^:]+):(\\d+):(.+)$', '{"host": "\\1", "port": \\2, "name": "\\3"}')
        | map('from_yaml') | list
      }}


    - name: Debug parsed members
      debug:
        var: pool_members


192.168.1.10:80:web01-node1
192.168.1.11:80:web01-node2
192.168.1.12:443:web01-node3


- name: Parse members into list of dictionaries
  set_fact:
    pool_members: >-
      {{
        members.splitlines()
        | reject('match', '^\\s*$')
        | map('regex_replace', '^([^:]+):(\\d+):(.+)$', '{"host": "\1", "port": \2, "name": "\3"}')
        | map('from_yaml')
        | select('defined')
        | list
      }}
